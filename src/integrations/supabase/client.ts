/**
 * Supabase Client with Error Handling
 * This file is automatically generated. Do not edit it directly.
 */
import { createClient } from '@supabase/supabase-js';
import type { Database } from './types';

const SUPABASE_URL = import.meta.env.VITE_SUPABASE_URL;
const SUPABASE_PUBLISHABLE_KEY = import.meta.env.VITE_SUPABASE_PUBLISHABLE_KEY;

// Log for debugging (only in development)
if (import.meta.env.DEV) {
  console.log('[Supabase] URL configured:', SUPABASE_URL ? '✓' : '✗');
  console.log('[Supabase] Key configured:', SUPABASE_PUBLISHABLE_KEY ? '✓' : '✗');
}

if (!SUPABASE_URL || !SUPABASE_PUBLISHABLE_KEY) {
  console.warn('[Supabase] Missing environment variables - using fallback values');
}

// Create Supabase client with error handling
export const supabase = createClient<Database>(SUPABASE_URL || '', SUPABASE_PUBLISHABLE_KEY || '', {
  auth: {
    storage: localStorage,
    persistSession: true,
    autoRefreshToken: true,
    detectSessionInUrl: true,
  },
  global: {
    headers: {
      'x-application-name': 'swipess',
    },
  },
});

// Handle auth state changes with error boundaries
supabase.auth.onAuthStateChange((event, session) => {
  if (import.meta.env.DEV) {
    console.log('[Supabase] Auth event:', event);
  }
  
  if (event === 'TOKEN_REFRESHED') {
    console.log('[Supabase] Token refreshed successfully');
  }
  
  if (event === 'TOKEN_REFRESH_ERROR') {
    console.warn('[Supabase] Token refresh failed - user may need to re-login');
  }
});
